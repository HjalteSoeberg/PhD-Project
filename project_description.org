#+TITLE: 
#+Author: Hjalte Søberg Mikkelsen
#+Date: 
#+EMAIL: hjalte.soeberg.mikkelsen@regionh.dk
#+LaTeX_CLASS: org-article 
#+OPTIONS: toc:nil
#+LaTeX_HEADER:\usepackage{authblk}
#+LaTeX_HEADER:\author{Hjalte Søberg Mikkelsen}
#+LaTeX_HEADER:\affil{Steno Diabetes Center Copenhagen}
#+setupfile:~/emacs-genome/snps/org-templates/setup-all-purpose.org
# #+superman-org-export-target: pdf
#+BIBLIOGRAPHY: bibliography.bib
#+cite_export: csl ~/emacs/.csl-styles/apa.csl




\newpage
* DP-next

My PhD project is part of a larger project called Sustainable Type 2 Diabetes Prevention for the 21st
Century (DP-next=. DP-Next is
a project aimed at developing a sustainably, effective strategy for
prevention of Type 2 Diabetes in Denmark, Greenland and the Faroe
Islands. #Stine kommentar: jeg synes du skal skrive lidt mere om DP_NEXT feks motivationen og formålet med studiet. Hvorfor er det vigtigt at forebyrgge T2 og især at gøre det på denne nye måde? hvad er det vi mener DP-next kan gøre bedre for verden? 
The project has been funded by a Steno National Collaborative
Grant from the Novo Nordisk Foundation. The DP-Next
project consists of four work packages: WP1 (Management and
Collaboration), WP2 (Risk Prediction), WP3 (Heterogeneity), WP4
(Intervention Development). My PhD project falls under WP2 of the
DP-Next project. In collaboration with the DP-Next teams I will work
on the statistial methods for a register-based diabetes risk
prediction model for the entire Danish, Greenlandic and Faroese
populations. Furthermore, my PhD project work is connected with WP4
where we will in collaboration derive subgroups based on heterogeneity
in T2D risk.

* My Project

My project aims to develop and adapt statistical methodology to create
a super learner algorithm which produces diabetes risk prediction
models based on Danish registry data. In collaboration with the research team
of WP2, the algorithm will be applied to build models for the Danish population,
be adapted to the Faroese and the Greenlandic populations. Specifically, I will
apply the algorithm to build and validate a type 2 diabetes risk prediction
model for the Danish population such that the model has the following
features:

- Exclusively use register-based data such that the prediction model
  can be calculated for the entire population of Denmark, without the
  need to ask individuals for additional information.
- Is designed for yearly updates based on newly available / updated
  risk indicator data.
- Can incorporate longitudinal data (risk factor trajectories)
- Can incorporate time-dynamic risk indicators from family members

In collaboration with the research team of WP4 I will also develop
statistical methods that can identify subgroups of the population with
high type 2 diabetes risk. To achieve these overarching goals for the DP-next
project, my PhD work is divided in the following three sub-projects.


** Project 1: Joint inference of cause-specific risks (Constrained risk prediction)
# Notes
# Talk more about the practical problem and then lead that into the theoretical problem

# Practical problem: Assume we observe two people - person 1 has a hba1c of 53 and person 2 has hba1c of 53 but has end stage brain cancer. Person 1 will have a larger risk of getting T2D than person 2 even though they have the same hba1c level, because the risk of person 2 dying is way higher than person 1. Therefore we need to report both the risk of T2D and the risk of dying, for the risk prediction to make sense. When estimating these cause specific risks in practise in can happen that person 2 has a risk of T2D of 53% and a risk of dying of 60%, i.e. the total sum of risks is over 100%. We therefore need some framework that ensures that $S = 1-F_1-F_2$ where S is the event free survival function, and F 1 and 2 are the cause specific cumulative incidence functions.

# old motivation
# parametricly in a time-to-event setting, we typically aim to estimate the cause-specific hazards or the cause specific cumulative incidence functions (CIFs). A common issue for these types of models is that the total estimated risk can exceed 1 [cite:@fine]. Specifically, I aim to estimate the cause-specific CIFs for T2D and death, denoted as $F_{T2D}$ and $F_{death}$, respectively. In practise, it is possible that $F_{T2D}+F_{death}>1$ which implies that $S\neq 1-(F_{T2D}+F_{death})$, where $S$ is the event free survival function. This typically occurs for covariate patterns that fall outside the range of those observed in the training data. Therefore, it is necessary to develop a modeling framework that enforces the constraint $S = 1-(F_{T2D}+F_{death})$ (or equivalently $F_{T2D}+F_{death}\leq 1$) holds for all covariate values.


# Motivation (Maybe should be risk of T2D and not dying??) # stine kommentar: Jeg synes du her skal starte med en argumentation for hvorfor det er sundhedsmæssigt vigtigt at lave en model - hvorfor er det man gerne vil idenitificere folk i høj risiko for T2? og så komme frem til at hvis man skal prædiktere T2 er det vigtigt også at tage højde for død.
# Current methods
When estimating cause-specific risks in practice, the standard approach is to estimate the risk of T2D and the risk of death separately. However, this is suboptimal when the goal is to report both risks simultaneously, since the risks are interdependent. When investigating heterogeneity in T2D risk across the population, the competing risk of death must be taken into account, as it directly influences the estimated T2D risk. For example, if two individuals have similar covariate profiles but one has end-stage brain cancer, that individual will have a lower estimated risk of developing T2D solely due to an increased risk of death. Reporting both competing risks is also important for potential clinical applications: an individual with a high risk of death should not be targeted for preventive intervention based solely on an elevated T2D risk.It is therefore necessary to estimate the cause-specific risks jointly, under appropriate constraints derived from the illness–death model. This issue has been examined previously, and a potential solution was proposed by [cite:@li2016]. However, that solution was developed only for the Cox proportional hazards model and has not been extended to other modeling frameworks.

The term risk of death can refer either to the risk of death without developing T2D or to the risk of death from any cause. The former is typically used in standard survival analysis, whereas the latter corresponds to the risk of death in the illness–death model. For this project, I will focus on the risk of death from any cause, as this measure also includes the risk of death occurring after T2D onset.


# Work plan #Stine kommentar: Jeg kunne godt tænke mig lidt flere detaljer - feks. uddybe hvad der er "required constraint". Og hvilke parametrisk, semi-parametriske og machine learning approaches skal med i superlearner. Og starter du med en model og så putter det i en super learner eller hvordan? Det er sikkert dumme spørgsmål fra min side, men jeg plejer at sige at en metode skal være som en kogebog: hvis andre har de samme indgredienser som dig (altså regster data), så skal de, ved at læse dit metode afsnit, mere eller mindre kunne komme frem til det samme som dig. Det behøver ikke være meget detaljeret, men lidt mere end det her :)
In this project, I aim to generalize this approach within the Super Learner algorithm [cite:@super], ensuring that both the discrete and ensemble versions of the Super Learner satisfy the required constraint. The resulting Super Learner will produce the best-performing T2D risk prediction model by combining parametric, semi-parametric, and machine learning methods while maintaining coherence between the competing risks. Ultimately, the model will use Danish registry data to predict both the 5- and 10-year risks of developing T2D and the 5- and 10-year risks of death from any cause.

** Project 2: Large-Language-Models in risk prediction
# The methods described also needs to be more precise (it has to make sense reading it in 2 years)

# Motivation
#Stine kommentar: jeg synes du skal tilføje lidt om hvad man kan bruge de to registre til og hvorfor de er gode at have i en prædiktionsmodel. Man bliver kastet lidt ind i det som det er nu :)
To build the most accurate risk prediction model for T2D, it is essential to incorporate all available data. However, this is not a straightforward task, as the Danish registry data used in this project are longitudinal, and the interpretation of missingness varies across registries. Two of the registries used in this project are the Danish National Prescription Registry (LMDB) and the Register of Laboratory Results for Research (RLRR).
In the LMDB, a missing observation indicates that an individual was not prescribed any drugs. In contrast, in the RLRR, a missing observation does not imply that the individual lacks biomarker data—it merely indicates that no laboratory measurements were recorded during that period. Furthermore, the time points of measurements differ from person to person. For example, if we wish to examine the most recent measurement of a covariate X before time 0, the last measurement for person 1 might be $X(0 - t)$, where $t=1$ day, whereas for person 2 it could be $X(0-s)$, with $s\neq t$ . This pattern is typical for most, if not all, covariates in the registries.

Such data structures are not straightforward to incorporate into traditional likelihood-based risk prediction frameworks, which typically rely on summarizing longitudinal information (e.g., using means or weighted averages). Consequently, new methodological approaches are required to fully exploit the richness and temporal dynamics of the Danish registry data.

# Current methods
To address this challenge, recent studies have proposed the use of machine learning methods, in particular Neural Networks. [cite:@dynamicdeephit] build the Dynamic-DeepHit model that can incorporate longitudinal data measured at irregular timepoints to estimate the cause-specific cumulative incidence functions. However, it remains unclear how the model handles missing data or scales to large registry datasets. A similar approach was taken by [cite:@wright2021], who employed recurrent neural networks (RNNs) to efficiently incorporate covariate histories into a risk prediction model, where the model was trained on danish registry data. A natural extension of these methods is to use Transformers instead of RNNs, which have the advantage of better handling large datasets and longitudinal data with long histories [cite:@attention]. Using Transformers will make the framework similar to that of large language models (LLMs), which recently have been used for disease risk prediction by [cite:@delphi], who proposed a modified GPT-based model to predict the risk of over 1,000 diseases using data from the UK Biobank.

# Work plan
In this project, I will develop a large language model for T2D risk prediction, following a similar approach to [cite:@delphi]. Specifically, I will train a modified GPT-based model on Danish registry data to predict T2D risk exclusively. If this proves too challenging — given that this is a relatively unexplored area — I will instead employ methods similar to those proposed by [cite:@dynamicdeephit] and [cite:@wright2021].

The model developed in this project will be build on Danish registry data exclusively, and will predict the 5- and 10-year risk of developing type 2 diabetes and predict the 5- and 10-year risk of dying from any cause. This model will then be compared with the Super Learner Algorithm devolped in Project 1, and the best performing T2D risk prediction model will be used for the DP-Next project.

** Project 3: Identifying subgroups with high diabetes risk
# 1. Motivation (please add something about WP4 and say risk of diabetes instead of risk)
WP4 of the DP-Next project aims to develop targeted intervention strategies for the prevention of type 2 diabetes (T2D) among subgroups of the Danish population identified as being at high risk. These high-risk subgroups will be identified in the present project using the best performing T2D risk prediction model developed in Projects 1 and 2. The subgroups will be defined based on covariate patterns - for example, one subgroup might consist of males under 40 years of age with a body mass index (BMI) of 25 or higher. The overall goal is to identify specific covariate patterns that define the segments of the Danish population with the highest risk of developing T2D.

Because the aim of WP4 is to recruit high-risk individuals from the Danish population into newly developed intervention strategies, the identified subgroups should be both recruitable and suitable for intervention. Therefore, I will aim to identify multiple high-risk subgroups with diverse covariate patterns, allowing the WP4 team to select those most appropriate for their recruitment and intervention objectives.

# 2. Current methods
The subgroup analysis carried out in this project will be entirely data driven. Data driven subgroup analysis methods are already well devolped, with methods such as [cite:@SDmapSubgroup] who has developed the SD-Map algorithm, which relies on the Frequent Patern Growth (FP-growth) algorithm, for exhaustive and efficient subgroup discovery. Other methods such as regression trees or cluster analysis are also frequently used for subgroup discovery, with examples such as [cite:@subgrouptree] or [cite:@parikh2021]. These methods are however notoriously unstable, especially for large data [cite:@wani2024], and will need carefull considerations to identify the true high riks subgroups of the population.


# 3. Work plan
In this project, I will apply the best-performing T2D risk prediction model from Projects 1 and 2 to the entire Danish population, thereby obtaining an estimated T2D risk for each individual. I will then use the SD-Map or cluster analysis to identify the subgroups with the highest average T2D risk. To make the search more stable and the subgroups more interpretable, the subgroups will be defined based on 2-4 covariates. All subgroups with an average risk exceeding some threshold $\epsilon$ will be reported to the WP4 team, who can then select the subgroups most suitable for their intervention study.


*** COMMENT Potential methods and thoughts
#Stine kommentar: jeg synes de to første punkter er meget relevante og noget du skal putte op i introduktionen
In motivation talk more about the real world problems and what DP-next wants.
Talk to the people from wp4 to know exactly what they want (should groups be pre-defined, should risk treshold be pre-defined, how many people should be in the groups).
Maybe write the problem up mathematically

Thomas does the following (Sounds like this is what the WP4 people would like):
- Use the model on all individuals
- Only look at the people with a risk greater than $\xi$ (some number)
- Cluster people into groups based on covariates and make the clusters change size based on covariates reprensentitivenes (how often we see that specific covariate value in the population.



#Stine kommentar: jeg vil flytte det her afsnit op til før du beskriver dine tre mål - det gør det meget nemmere at forstå din metode
** Data
The T2D risk prediction model will be developed using synthetic data following the
structure of the Danish register-data. All analyses will be conducted
on a DST project database and transferred/validated in both real
Danish register data, and in Greenlandic and Faroese data. Using
register data available on DST, the type 2 diabetes outcome will be
defined according to a previously validated classification
[cite:@isaksen2023validation]. The analyses using Danish register data
will be conducted on the DST project databyase at Steno Diabetes
Center Aarhus, incorporating a wide range of data sources for model
development, including the Danish Diabetes Database and several other
health and socio-demographic registers.

\newpage

# HJALTE: I think that much of comes below is only marginally relevant for your phd protocol
# and the relevant part needs to be integrated into the 3 projects above. do you agree?

* COMMENT WP2
#Stine kommentar: det er præcis det her jeg efterspørger i introduktionen :)
It is well known that type 2 diabetes (T2D) in trial settings can be prevented in high-risk individuals
through intensive lifestyle modifications. However, translating these findings into sustainable,
real-world practices has proved difficult. The original interventions were too resource-intensive for
large-scale use, while less intensive approaches only produced temporary weight loss without long-term
diabetes prevention. Additionally, many of the highest at-risk groups are rarely identified in routine
care, and participation in health promoting programs among these groups has declined. Despite these
challenges, new opportunities for diabetes prevention have emerged, including advanced health data
systems, machine learning, better understanding of behavior change, innovative intervention methods,
real-time monitoring technologies, and widespread use of apps and smartphones. These resources remain
underutilized but hold great potential to improve prevention strategies.

#Stine kommentar: det er fint med det der står i nedenstående men put det i introduktionen og målret det, således at du kun har det med som er relevant for dit studie. Feks kan du godt slette alt det om at det skal overføres til Grønland og Færøerne, og hvis der er andre aspekter du ikke skal kigge på
** Aim
The aim of WP2 is to develop an operational risk model that calculates an individual diabetes risk
prediction for the entire population of Denmark, Greenland and the Faroe Islands. We will achieve this
by designing a risk prediction algorithm based exclusively on existing register-based data. 

Within each of the three target countries, the risk prediction model will be used for the
identification of subgroups at high diabetes risk. The objective is to identify among individuals
with high diabetes risk groups of people with different clustered combinations of contributing risk
indicators. In a hypothetical example, women aged over 50 with two first-degree relatives with diabetes
may have a an equivalent absolute diabetes risk to non-participants in national screening programs with
low socio-economic status or to men aged over 55 with a history of cardiovascular disease; However,
these would constitute three different high risk subgroups. The subgroup analysis will define these
subgroups based on a data-driven approaches which may include cluster-analysis type methods to assign
individuals to mutually exclusive risk groups, decision-tree based methods that prioritize maximally
informative variables and apply these in nested sequences, or dimensionality reduction methods such as
principal component analyses that map all individuals along a reduced set of orthogonal risk axes.
The output of these analyses will serve as input to DP-Next WP 4, by defining high risk subgroups
that can be defined operationally with relative ease. One or two of these subgroups will form the
target populations for the process of participative intervention development described in WP4

*** Individuals
In Denmark, based on matching data availability between the DST and EMR data environments, a suitable
model from the population focused analyses will be selected for transfer to the EMR environment
(e.g. family history or SES data may not be available in the EMR environment). The prediction model
will be transferred and its performance will be validated in a closed, older extract of data
(e.g. with a 5-year follow-up horizon for incident diabetes). Subsequently, the added predictive
value of a restricted set of additional variables that may be available in the EMR but not the DST
environment will be assessed (e.g. BMI). Analyses will focus on quantifying the predicted risk of
diabetes from the point of view of an individual and their physician. This means that beside the
over-all risk estimate, an individual breakdown of the proportion of that risk explained by the
various risk indicators should be calculated; subdivided by modifiable and unmodifiable risk factors.
This may require a re-analysis based on an underlying aetiological model rather than a simply
predictive model, in order to allow estimates to be used in counterfactual scenarios used in planning
a clinical course of action. E.g: Your calculated 5-year risk is currently 6%. If we manage to reduce
your weight by 2kg and your HbA1c by 1 mmol/mol, your risk would be reduced to 5%.

*** The Health System
After validation of the individual EMR based models, predicted diabetes risk estimates will be
calculated based on the most up-to-date data for individuals attending a few selected clinical
settings (e.g. a few selected GP practices) in order to evaluate how individuals and health care
practitioners understand and interpret the data and to make an initial assessment of how these
individual risk estimates may be incorporated into the day to day data flow of a practice. Finally,
the possibilities for integrating the individual-level predicted risk data into the SAMBLIK system
will be explored and piloted.


** Work flow
We will build upon our own methodology framework, experience and paradigms for making medical risk prediction models [cite:@vistisen2016prediction], [cite:@wright2021] [cite:@gerds2021medical], [cite:@liu2024predicting]. We will develop a lego system of learners (parametric models and machine 
learning) which provides a super learner algorithm [cite:@super] for prediction. The super learner algorithm can be applied to (a subset of) the current data. It uses nested cross-validation to return the best risk prediction model according to current constraints and outperforms all benchmark models.

*** Danish registers 
- CPR Register [1968-]
- LPR (Danish National Patient Registry) [1977-]
- LMDB (Danish National Prescription Registry) and the Hospital Medication Register [1995-]
- Register of Laboratory Results for Research [2011/2015Q4-]
- Cancer Register [1987-]
- Pathology Register [1997-]
- Diabase (RKKP) [2013-]
- RKKP (Danish Registry of Diabetes) [2022Q3-]
- Health Insurance [1990-]
- Medical Birth Register [1973-]
- DREAM database [1991-/2008-]
- HANDIC Register [2013-/2018-]
- FAIK/register of incomes [1990-]
- Vaccination Register [2013-/2016-]



\newpage
* Bibliography
#+print_bibliography:
